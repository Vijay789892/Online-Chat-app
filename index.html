<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>चैट ऐप</title>

    <style>
        /* सामान्य स्टाइलिंग */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #1e3c72, #2a5298); /* सुंदर नीला ग्रेडिएंट */
            height: 100vh; /* पूरी स्क्रीन की ऊंचाई */
            overflow: hidden; /* स्क्रॉलिंग को रोकना */
            color: white; /* डिफ़ॉल्ट टेक्स्ट रंग */
        }

        /* हेडर */
        .header {
            background: rgba(0, 0, 0, 0.2); /* हल्का पारदर्शी काला */
            backdrop-filter: blur(10px); /* बैकग्राउंड ब्लर इफ़ेक्ट */
            padding: 10px 15px;
            display: flex;
            align-items: center; /* वर्टिकल अलाइनमेंट */
            justify-content: space-between; /* तत्वों के बीच स्पेस */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* हल्का बॉर्डर */
            height: 50px; /* हेडर की ऊंचाई */
            flex-wrap: wrap; /* छोटे स्क्रीन पर रैप करने के लिए */
            justify-content: center; /* छोटे स्क्रीन पर सेंटर अलाइन करने के लिए */
        }

        .header .app-title {
            font-size: 20px;
            font-weight: bold;
            margin: 0 15px; /* हेडर के बटनों से थोड़ा मार्जिन */
        }

        .header-buttons {
            display: flex;
            align-items: center;
            gap: 10px; /* बटनों के बीच स्पेस */
        }

        .home-btn, .profile-btn, .share-btn {
            color: white;
            border: none;
            padding: 8px 18px; /* पैडिंग बढ़ाई गई */
            border-radius: 25px; /* गोल किनारे */
            cursor: pointer;
            font-size: 13px; /* फॉन्ट साइज़ बढ़ाया गया */
            font-weight: bold;
            transition: all 0.3s ease; /* स्मूथ ट्रांजिशन */
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3); /* शैडो */
            display: flex;
            align-items: center;
            gap: 8px; /* आइकन और टेक्स्ट के बीच स्पेस */
        }

        .home-btn { background: linear-gradient(45deg, #ff4757, #ff6b7a); } /* लाल ग्रेडिएंट */
        .home-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4); }

        .profile-btn { background: linear-gradient(45deg, #2ecc71, #27ae60); } /* हरा ग्रेडिएंट */
        .profile-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4); }

        .share-btn {
            background: linear-gradient(45deg, #f39c12, #e67e22); /* नारंगी ग्रेडिएंट */
        }
        .share-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(243, 152, 18, 0.4); }

        /* प्रोफाइल मोडल */
        .modal {
            display: none; /* डिफ़ॉल्ट रूप से छिपा हुआ */
            position: fixed; /* स्क्रीन पर फिक्स */
            z-index: 1000; /* सबसे ऊपर */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* पारदर्शी काला बैकग्राउंड */
            backdrop-filter: blur(5px); /* ब्लर इफ़ेक्ट */
        }

        .modal-content {
            background: linear-gradient(145deg, #667eea, #764ba2); /* बैंगनी ग्रेडिएंट */
            margin: 10% auto; /* ऊपर से 10% और बीच में */
            padding: 25px; /* पैडिंग बढ़ाई गई */
            border-radius: 15px; /* गोल किनारे */
            width: 90%;
            max-width: 400px; /* अधिकतम चौड़ाई */
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* शैडो */
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px; /* हेडर के नीचे थोड़ा स्पेस */
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); /* हल्का बॉर्डर */
        }

        .modal-header h3 {
            font-size: 20px;
            font-weight: bold;
        }

        .close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 22px; /* थोड़ा बड़ा */
            border-radius: 50%; /* गोल क्लोज बटन */
            width: 35px; /* साइज़ बढ़ाया गया */
            height: 35px; /* साइज़ बढ़ाया गया */
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }

        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 15px; /* तत्वों के बीच स्पेस */
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px; /* लेबल और इनपुट के बीच स्पेस बढ़ाया गया */
        }

        .form-group label {
            font-size: 14px;
            font-weight: bold;
        }

        .form-group input {
            padding: 12px; /* पैडिंग बढ़ाई गई */
            border: none;
            border-radius: 10px; /* गोल किनारे */
            font-size: 15px; /* फॉन्ट साइज़ बढ़ाया गया */
            background: rgba(255, 255, 255, 0.9); /* हल्का पारदर्शी सफेद */
            color: #333; /* टेक्स्ट का रंग */
            transition: all 0.2s ease;
        }

        .form-group input:focus {
            outline: none;
            border: 2px solid #764ba2; /* फोकस पर बॉर्डर */
        }

        .emoji-selector {
            display: grid;
            grid-template-columns: repeat(8, 1fr); /* 8 कॉलम ग्रिड */
            gap: 10px; /* गैप बढ़ाया गया */
            background: rgba(255, 255, 255, 0.1); /* हल्का पारदर्शी सफेद बैकग्राउंड */
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .emoji-option {
            background: transparent;
            border: 2px solid transparent; /* डिफ़ॉल्ट रूप से पारदर्शी बॉर्डर */
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            font-size: 24px; /* Emoji साइज़ बढ़ाया गया */
            transition: all 0.3s ease;
            text-align: center; /* emoji को सेंटर में */
            display: flex; /* सेंटर करने के लिए */
            align-items: center; /* सेंटर करने के लिए */
            justify-content: center; /* सेंटर करने के लिए */
        }

        .emoji-option:hover {
            background: rgba(255, 255, 255, 0.2); /* होवर पर थोड़ा पारदर्शी */
            transform: scale(1.1); /* थोड़ा बड़ा करना */
        }

        .emoji-option.selected {
            border-color: #fff; /* चयनित emoji पर सफेद बॉर्डर */
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1); /* चयनित emoji को थोड़ा बड़ा दिखाएं */
        }

        .save-btn {
            background: linear-gradient(45deg, #2ecc71, #27ae60); /* हरा ग्रेडिएंट */
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px; /* गोल किनारे */
            cursor: pointer;
            font-size: 15px; /* फॉन्ट साइज़ बढ़ाया गया */
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(46, 204, 113, 0.3);
            margin-top: 10px; /* ऊपर से स्पेस */
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }

        /* पसंदीदा दोस्त मोडल */
        .fav-friend-item {
            background: rgba(255, 255, 255, 0.1);
            margin: 6px 0;
            padding: 12px; /* पैडिंग बढ़ाई गई */
            border-radius: 12px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .fav-friend-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px); /* थोड़ा खिसकाव */
        }

        /* मुख्य कंटेनर */
        .main-container {
            display: flex;
            height: calc(100vh - 50px); /* हेडर की ऊंचाई छोड़कर बाकी */
        }

        /* उपयोगकर्ता साइडबार */
        .users-panel {
            width: 280px; /* चौड़ाई बढ़ाई गई */
            background: rgba(255, 255, 255, 0.05); /* बैकग्राउंड थोड़ा हल्का */
            backdrop-filter: blur(20px); /* ब्लर इफ़ेक्ट थोड़ा और */
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0; /* यह सिकुड़ेगा नहीं */
            display: flex;
            flex-direction: column; /* कंटेंट्स को कॉलम में अरेंज करें */
        }

        .users-header {
            padding: 15px; /* पैडिंग बढ़ाई गई */
            background: linear-gradient(45deg, #5f27cd, #a55eea); /* बैंगनी ग्रेडिएंट */
            color: white;
            text-align: center;
            font-size: 14px; /* फॉन्ट साइज़ बढ़ाया गया */
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* बॉर्डर */
        }

        .online-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px; /* पैडिंग बढ़ाई गई */
            border-radius: 12px; /* गोल किनारे */
            font-size: 11px; /* फॉन्ट साइज़ बढ़ाया गया */
            font-weight: bold;
        }

        .users-list {
            height: calc(100% - 60px); /* हेडर की ऊंचाई छोड़कर */
            overflow-y: auto; /* स्क्रॉल बार */
            padding: 10px; /* पैडिंग बढ़ाई गई */
            flex-grow: 1; /* बची हुई जगह ले लेगा */
        }

        .user-item {
            background: rgba(255, 255, 255, 0.08); /* बैकग्राउंड थोड़ा और पारदर्शी */
            margin: 8px 0; /* मार्जिन बढ़ाया गया */
            padding: 10px 15px; /* पैडिंग बढ़ाई गई */
            border-radius: 15px; /* गोल किनारे */
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px); /* थोड़ा खिसकाव */
        }

        .user-avatar {
            width: 40px; /* साइज़ बढ़ाया गया */
            height: 40px; /* साइज़ बढ़ाया गया */
            background: linear-gradient(45deg, #ff9ff3, #f368e0); /* गुलाबी ग्रेडिएंट */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px; /* फॉन्ट साइज़ बढ़ाया गया */
            color: white;
            margin-right: 15px; /* मार्जिन बढ़ाया गया */
            flex-shrink: 0; /* सिकुड़ेगा नहीं */
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); /* शैडो */
        }

        .user-details {
            flex: 1; /* बाकी जगह ले लेगा */
            overflow: hidden; /* अगर नाम बहुत लंबा हो तो */
            text-overflow: ellipsis; /* अगर नाम बहुत लंबा हो तो "..." दिखाएगा */
            white-space: nowrap; /* एक लाइन में रखेगा */
        }

        .user-name {
            color: white;
            font-size: 14px; /* फॉन्ट साइज़ बढ़ाया गया */
            font-weight: bold;
            margin-bottom: 3px;
        }

        .user-status {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px; /* फॉन्ट साइज़ बढ़ाया गया */
        }

        .online-dot {
            width: 10px; /* साइज़ बढ़ाया गया */
            height: 10px; /* साइज़ बढ़ाया गया */
            background: #2ed573; /* हरा रंग */
            border-radius: 50%;
            margin-left: 15px; /* दाईं ओर स्पेस */
            animation: blink 2s infinite; /* ब्लिंकिंग एनीमेशन */
            box-shadow: 0 0 5px rgba(46, 204, 113, 0.8); /* शैडो */
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        /* चैट एरिया */
        .chat-area {
            flex: 1; /* बाकी बची हुई जगह ले लेगा */
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05); /* हल्का पारदर्शी बैकग्राउंड */
            min-height: 0; /* फ्लेक्स बच्चों के लिए महत्वपूर्ण */
        }

        .chat-header {
            padding: 15px; /* पैडिंग बढ़ाई गई */
            background: rgba(0, 0, 0, 0.15); /* थोड़ा गहरा बैकग्राउंड */
            color: white;
            font-size: 15px; /* फॉन्ट साइज़ बढ़ाया गया */
            font-weight: bold;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0; /* सिकुड़ेगा नहीं */
            display: flex;
            align-items: center;
            justify-content: space-between; /* हेडर में बैक बटन को जोड़ने के लिए */
        }

        .back-to-general-btn { /* नया बैक बटन */
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 6px 12px; /* पैडिंग बढ़ाई गई */
            border-radius: 18px; /* गोल किनारे */
            cursor: pointer;
            font-size: 12px; /* फॉन्ट साइज़ कम किया गया */
            font-weight: bold;
            transition: all 0.3s ease;
            margin-right: 10px;
            display: none; /* शुरू में छिपा हुआ */
        }
        .back-to-general-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }


        .messages-container {
            flex: 1; /* संदेशों को बाकी जगह देगा */
            padding: 15px 20px; /* पैडिंग बढ़ाई गई */
            overflow-y: auto; /* स्क्रॉल करने योग्य */
            display: flex;
            flex-direction: column;
            gap: 12px; /* संदेशों के बीच स्पेस बढ़ाया गया */
            min-height: 0; /* स्क्रॉलिंग के लिए आवश्यक */
        }

        .message {
            max-width: 65%; /* संदेशों की अधिकतम चौड़ाई */
            padding: 12px 18px; /* पैडिंग बढ़ाई गई */
            border-radius: 20px; /* गोल किनारे */
            position: relative;
            animation: fadeIn 0.3s ease;
            user-select: none; /* संदेश पर सेलेक्ट को रोकना */
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); /* हल्का शैडो */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.sent {
            background: linear-gradient(135deg, #667eea, #764ba2); /* बैंगनी ग्रेडिएंट */
            color: white;
            align-self: flex-end; /* दाईं ओर अलाइन */
            border-bottom-right-radius: 8px; /* बॉटम राइट कॉर्नर को थोड़ा कोना */
        }

        .message.received {
            background: rgba(255, 255, 255, 0.9); /* हल्का पारदर्शी सफेद */
            color: #333; /* गहरा टेक्स्ट रंग */
            align-self: flex-start; /* बाईं ओर अलाइन */
            border-bottom-left-radius: 8px; /* बॉटम लेफ्ट कॉर्नर को थोड़ा कोना */
        }

        .msg-author {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 5px; /* मार्जिन बढ़ाया गया */
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 8px; /* स्पेस बढ़ाया गया */
        }

        .msg-author-emoji {
            font-size: 16px; /* Emoji साइज़ बढ़ाया गया */
        }

        .msg-text {
            font-size: 13px;
            line-height: 1.4; /* लाइन स्पेसिंग बढ़ाई गई */
        }

        .msg-time {
            font-size: 9px; /* फॉन्ट साइज़ कम किया गया */
            opacity: 0.6;
            margin-top: 5px; /* मार्जिन बढ़ाया गया */
            text-align: right; /* समय को दाईं ओर */
        }

        /* इनपुट एरिया */
        .input-area {
            padding: 15px; /* पैडिंग बढ़ाई गई */
            background: rgba(0, 0, 0, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0; /* सिकुड़ेगा नहीं */
            position: relative;
            z-index: 10;
        }

        .input-box {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 30px; /* गोल किनारे और बड़े */
            padding: 5px; /* पैडिंग बढ़ाई गई */
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); /* शैडो और गहरा */
        }

        .msg-input {
            flex: 1;
            border: none;
            padding: 12px 20px; /* पैडिंग बढ़ाई गई */
            border-radius: 25px; /* गोल किनारे */
            font-size: 14px; /* फॉन्ट साइज़ बढ़ाया गया */
            outline: none; /* आउटलाइन हटाना */
            background: transparent; /* बैकग्राउंड को इनपुट बॉक्स से लेना */
            color: #333; /* टेक्स्ट का रंग */
        }

        .msg-input::placeholder {
            color: rgba(51, 51, 51, 0.6); /* प्लेसहोल्डर रंग */
        }

        .send-btn {
            background: linear-gradient(45deg, #667eea, #764ba2); /* बैंगनी ग्रेडिएंट */
            color: white;
            border: none;
            width: 45px; /* साइज़ बढ़ाया गया */
            height: 45px; /* साइज़ बढ़ाया गया */
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 18px; /* Icon साइज़ बढ़ाया गया */
            margin-left: 8px; /* इनपुट से थोड़ी दूरी */
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        /* अटैचमेंट बटन और मेनू */
        .attachment-btn {
            background: linear-gradient(45deg, #48dbfb, #0abde3); /* नीला ग्रेडिएंट */
            color: white;
            border: none;
            width: 45px; /* साइज़ बढ़ाया गया */
            height: 45px; /* साइज़ बढ़ाया गया */
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 22px; /* Icon साइज़ बढ़ाया गया */
            font-weight: bold;
            margin-left: 8px; /* इनपुट से थोड़ी दूरी */
        }

        .attachment-btn:hover {
            transform: scale(1.1) rotate(90deg); /* रोटेट इफ़ेक्ट */
            box-shadow: 0 4px 15px rgba(72, 219, 251, 0.4);
        }

        .attachment-menu {
            position: absolute;
            bottom: 75px; /* इनपुट एरिया के ऊपर */
            left: 15px;
            background: rgba(0, 0, 0, 0.7); /* गहरा पारदर्शी बैकग्राउंड */
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 12px; /* पैडिंग बढ़ाई गई */
            display: none; /* डिफ़ॉल्ट रूप से छिपा हुआ */
            grid-template-columns: 1fr 1fr; /* 2 कॉलम */
            gap: 10px;
            z-index: 101; /* इनपुट बॉक्स के ऊपर */
            animation: popIn 0.2s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); /* शैडो */
        }

        .attachment-menu.show {
            display: grid; /* दिखाने के लिए */
        }

        .attachment-option {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px; /* फॉन्ट साइज़ बढ़ाया गया */
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px; /* स्पेस बढ़ाया गया */
        }

        .attachment-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.8) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* स्क्रॉलबार स्टाइलिंग */
        ::-webkit-scrollbar {
            width: 6px; /* स्क्रॉलबार की चौड़ाई */
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05); /* ट्रैक का बैकग्राउंड */
            border-radius: 3px; /* ट्रैक के गोल किनारे */
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3); /* थंब को हल्का पारदर्शी */
            border-radius: 3px; /* थंब के गोल किनारे */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5); /* होवर पर और पारदर्शी */
        }

        /* मोबाइल रिस्पॉन्सिव */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column; /* कॉलम में लेआउट */
            }

            .users-panel {
                width: 100%;
                height: 130px; /* ऊंचाई थोड़ी बढ़ाई गई */
                flex-shrink: 0;
            }

            .users-list {
                display: flex; /* क्षैतिज स्क्रॉल के लिए */
                overflow-x: auto; /* क्षैतिज स्क्रॉल */
                height: calc(100% - 65px); /* हेडर की ऊंचाई छोड़कर */
                padding: 10px 15px; /* पैडिंग बढ़ाई गई */
            }

            .user-item {
                min-width: 180px; /* मिनिमम चौड़ाई */
                margin-right: 10px; /* क्षैतिज स्पेस */
                margin-bottom: 0; /* वर्टिकल मार्जिन हटाया */
            }

            .user-avatar {
                width: 45px;
                height: 45px;
                font-size: 22px;
            }

            .user-name { font-size: 15px; }
            .user-status { font-size: 12px; }

            .chat-area {
                height: calc(100vh - 180px); /* मोबाइल पर कुल ऊंचाई */
            }

            .messages-container {
                max-height: calc(100vh - 300px); /* इनपुट और हेडर को छोड़कर */
            }

            .home-btn, .profile-btn, .share-btn {
                padding: 6px 15px;
                font-size: 12px;
            }

            .header .app-title {
                font-size: 18px;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto; /* मोबाइल पर और ऊपर से */
            }

            .emoji-selector {
                grid-template-columns: repeat(6, 1fr); /* मोबाइल पर कम कॉलम */
            }

            .emoji-option { font-size: 20px; }

            .attachment-menu {
                bottom: 80px; /* इनपुट के ऊपर थोड़ी और जगह */
                left: 50%; /* बीच में लाने के लिए */
                transform: translateX(-50%); /* सेंटर अलाइन करने के लिए */
            }

            .header {
                height: auto; /* हेडर की ऊंचाई एडजस्ट करें */
                flex-wrap: wrap; /* मोबाइल पर एलिमेंट्स को रैप करें */
                justify-content: center; /* सेंटर अलाइन करें */
                padding: 10px 10px;
            }
            .header .app-title {
                order: 1; /* टाइटल को बीच में लाएं */
                margin: 8px 0;
            }
            .header-buttons {
                order: 2; /* बटन को टाइटल के नीचे लाएं */
                margin-top: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <button class="home-btn" id="homeBtn">
            🏠 <span id="userName">UserXYZ</span>
        </button>
        <div class="app-title">🗣️</div>
        <div class="header-buttons">
            <button class="share-btn" id="shareAppBtn">🚀 शेयर करें</button>
            <button class="profile-btn" id="profileBtn">
                👤 प्रोफाइल
            </button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>प्रोफाइल सेटअप</h3>
                <button class="close" id="closeModal">×</button>
            </div>
            <div class="profile-form">
                <div class="form-group">
                    <label for="nameInput">नाम:</label>
                    <input type="text" id="nameInput" placeholder="अपना नाम लिखें">
                </div>
                <div class="form-group">
                    <label>अपना emoji चुनें:</label>
                    <div class="emoji-selector" id="emojiSelector">
                        <!-- Emojis will be populated by JavaScript -->
                    </div>
                </div>
                <button class="save-btn" id="saveProfile">सेव करें</button>
            </div>
        </div>
    </div>

    <!-- Favorite Friends Modal (होम बटन पर क्लिक करने पर खुलेगा) -->
    <div id="favFriendsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>पसंदीदा दोस्त</h3>
                <button class="close" id="closeFavFriendsModal">×</button>
            </div>
            <div id="favFriendsList">
                <!-- Favorite friends will be listed here -->
            </div>
        </div>
    </div>

    <!-- Main container -->
    <div class="main-container">
        <!-- Users sidebar -->
        <div class="users-panel">
            <div class="users-header">
                <div>ऑनलाइन</div>
                <div class="online-badge" id="userCount">0</div>
            </div>
            <div class="users-list" id="usersList">
                <!-- Users will appear here -->
            </div>
        </div>

        <!-- Chat area -->
        <div class="chat-area">
            <div class="chat-header" id="chatHeader">
                <button class="back-to-general-btn" id="backToGeneralBtn">⬅️ सामान्य चैट</button>
                💬 सामान्य चैट
            </div>

            <div class="messages-container" id="messagesContainer">
                <!-- Messages will appear here -->
            </div>

            <div class="input-area">
                <div class="input-box">
                    <!-- अटैचमेंट बटन -->
                    <button id="attachmentBtn" class="attachment-btn">+</button>
                    <input type="text" id="msgInput" class="msg-input" placeholder="मैसेज...">
                    <button id="sendBtn" class="send-btn">➤</button>
                </div>
                <!-- अटैचमेंट मेनू -->
                <div id="attachmentMenu" class="attachment-menu">
                    <button class="attachment-option" id="photoBtn">🖼️ फोटो</button>
                    <button class="attachment-option" id="audioBtn">🎤 आवाज</button>
                    <button class="attachment-option" id="fileBtn">📎 फाइल</button>
                    <button class="attachment-option" id="videoCallBtn">📹 वीडियो कॉल</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AlzaSyDVsNMK4XKmKQCdJdP3ywgrrtynRePec1g",
            authDomain: "tic-24b14.firebaseapp.com",
            databaseURL: "https://tic-24b14-default-rtdb.firebaseio.com",
            projectId: "tic-24b14",
            storageBucket: "tic-24b14.appspot.com",
            messagingSenderId: "671931471819",
            appId: "1:671931471819:web:c54c78483e170fae00c84e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Available emojis for profile
        const availableEmojis = [
            '👧', '👨', '👩', '🙅‍♂️', '🙆‍♀️', '🙆‍♂️', '🙋‍♀️', '🙋‍♂️',
            '🙎‍♀️', '🤷‍♂️', '🤷‍♀️', '🤦‍♀️', '👦', '👴', '👵', '🧑',
            '👨‍💼', '👩‍💼', '👨‍🎓', '👩‍🎓', '👨‍⚕️', '👩‍⚕️', '👨‍🏫', '👩‍🏫',
            '👮‍♂️', '👮‍♀️', '👷‍♂️', '👷‍♀️', '💂‍♂️', '💂‍♀️', '🕵️‍♂️', '🕵️‍♀️',
            '😇', '🤠', '🤡', '😈', '👻', '👽', '🤖', '😺', '🐶'
        ];

        // User setup
        let myName = "User" + Math.floor(Math.random() * 999);
        let myEmoji = '👤';

        // Load saved profile from localStorage
        const savedProfile = JSON.parse(localStorage.getItem('chatProfile') || '{}');
        if (savedProfile.name) {
            myName = savedProfile.name;
            myEmoji = savedProfile.emoji || '👤';
        }

        document.getElementById('userName').textContent = myName;

        const myId = db.ref().push().key; // Firebase द्वारा उत्पन्न अद्वितीय कुंजी
        const usersRef = db.ref('online_users');
        const myUserRef = usersRef.child(myId);
        const favFriendsRef = db.ref(`favorite_friends/${myId}`);
        const messagesRef = db.ref('messages'); // सामान्य चैट के लिए संदेश
        const directMessagesRef = db.ref('direct_messages'); // डायरेक्ट मैसेज के लिए

        // Store listeners so we can remove them later if needed
        let generalMessagesListener = null;
        let dmMessagesListener = null; // DM संदेशों के लिए अलग लिसनर

        // Add user online
        function updateUserStatus() {
            myUserRef.set({
                name: myName,
                emoji: myEmoji,
                time: Date.now()
            });
        }

        updateUserStatus();
        myUserRef.onDisconnect().remove(); // कनेक्शन टूटने पर खुद को हटा दें

        // DOM Elements
        const messagesContainer = document.getElementById('messagesContainer');
        const msgInput = document.getElementById('msgInput');
        const sendBtn = document.getElementById('sendBtn');
        const usersList = document.getElementById('usersList');
        const userCount = document.getElementById('userCount');
        const homeBtn = document.getElementById('homeBtn');
        const profileBtn = document.getElementById('profileBtn');
        const profileModal = document.getElementById('profileModal');
        const closeModal = document.getElementById('closeModal');
        const nameInput = document.getElementById('nameInput');
        const emojiSelector = document.getElementById('emojiSelector');
        const saveProfile = document.getElementById('saveProfile');
        const shareAppBtn = document.getElementById('shareAppBtn');
        const attachmentBtn = document.getElementById('attachmentBtn');
        const attachmentMenu = document.getElementById('attachmentMenu');
        const favFriendsModal = document.getElementById('favFriendsModal');
        const closeFavFriendsModal = document.getElementById('closeFavFriendsModal');
        const favFriendsListDiv = document.getElementById('favFriendsList');
        const chatHeader = document.getElementById('chatHeader');
        const backToGeneralBtn = document.getElementById('backToGeneralBtn');

        let onlineUsers = 0;
        let selectedEmoji = myEmoji;
        const userElements = {}; // DOM elements for users in the sidebar
        const favFriendElements = {}; // DOM elements for favorite friends
        let currentChatTarget = null; // Stores { id: '...', name: '...', emoji: '...' } for DM

        // Emoji Selector को पॉपुलेट करें
        availableEmojis.forEach(emoji => {
            const emojiBtn = document.createElement('button');
            emojiBtn.className = 'emoji-option';
            emojiBtn.textContent = emoji;
            emojiBtn.onclick = () => {
                document.querySelectorAll('.emoji-option').forEach(btn => btn.classList.remove('selected'));
                emojiBtn.classList.add('selected');
                selectedEmoji = emoji; // चयनित emoji को स्टोर करें
            };
            emojiSelector.appendChild(emojiBtn);
        });

        // Initialize selected emoji display
        const initialEmojiButtons = emojiSelector.querySelectorAll('.emoji-option');
        initialEmojiButtons.forEach(btn => {
            if (btn.textContent === myEmoji) {
                btn.classList.add('selected');
            }
        });

        // Modal functions
        profileBtn.onclick = () => {
            nameInput.value = myName;
            // Currently selected emoji को हाइलाइट करें
            const emojiButtons = emojiSelector.querySelectorAll('.emoji-option');
            emojiButtons.forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === myEmoji) {
                    btn.classList.add('selected');
                }
            });
            selectedEmoji = myEmoji; // वर्तमान emoji को चयनित के रूप में सेट करें
            profileModal.style.display = 'block';
        };

        closeModal.onclick = () => {
            profileModal.style.display = 'none';
        };

        // Modal के बाहर क्लिक करने पर मोडल बंद करें
        window.onclick = (e) => {
            if (e.target === profileModal) {
                profileModal.style.display = 'none';
            }
            if (e.target === favFriendsModal) {
                favFriendsModal.style.display = 'none';
            }
            // अगर मेनू के बाहर क्लिक किया जाता है तो मेनू बंद करें
            if (!attachmentMenu.contains(e.target) && e.target !== attachmentBtn) {
                attachmentMenu.classList.remove('show');
            }
        };

        // प्रोफाइल सेव करें
        saveProfile.onclick = () => {
            const newName = nameInput.value.trim();
            if (newName) {
                myName = newName;
                myEmoji = selectedEmoji;

                // localStorage में सेव करें
                localStorage.setItem('chatProfile', JSON.stringify({
                    name: myName,
                    emoji: myEmoji
                }));

                document.getElementById('userName').textContent = myName; // हेडर में नाम अपडेट करें
                updateUserStatus(); // Firebase में स्थिति अपडेट करें
                profileModal.style.display = 'none'; // मोडल बंद करें
            } else {
                alert('कृपया अपना नाम दर्ज करें।');
            }
        };

        // Home button: पसंदीदा दोस्तों को दिखाता है
        homeBtn.addEventListener('click', () => {
            loadFavoriteFriends(); // पसंदीदा दोस्तों को लोड करें
            favFriendsModal.style.display = 'block';
        });

        closeFavFriendsModal.onclick = () => {
            favFriendsModal.style.display = 'none';
        };

        // पसंदीदा दोस्तों को लोड करने का फ़ंक्शन
        function loadFavoriteFriends() {
            favFriendsListDiv.innerHTML = ''; // पिछली सूची को साफ़ करें
            favFriendsRef.once('value', (snapshot) => {
                const friends = snapshot.val();
                if (friends) {
                    const friendIds = Object.keys(friends).sort((a, b) => friends[a].addedTime - friends[b].addedTime); // समय के अनुसार सॉर्ट करें
                    friendIds.forEach(friendId => {
                        const friend = friends[friendId];
                        const favFriendEl = document.createElement('div');
                        favFriendEl.className = 'user-item fav-friend-item'; // स्टाइलिंग के लिए क्लास का पुन: उपयोग करें
                        favFriendEl.innerHTML = `
                            <div class="user-avatar">${friend.emoji || '👤'}</div>
                            <div class="user-details">
                                <div class="user-name">${friend.name}</div>
                                <div class="user-status">पसंदीदा</div>
                            </div>
                        `;
                        // पसंदीदा दोस्त पर क्लिक करने पर डायरेक्ट मैसेज शुरू करें
                        favFriendEl.onclick = () => startDirectMessage(friendId, friend.name, friend.emoji);
                        favFriendsListDiv.appendChild(favFriendEl);
                    });
                } else {
                    favFriendsListDiv.innerHTML = '<p style="text-align: center; opacity: 0.7;">कोई पसंदीदा दोस्त नहीं है।</p>';
                }
            });
        }

        // किसी उपयोगकर्ता को पसंदीदा दोस्त के रूप में जोड़ने का फ़ंक्शन
        function addFavoriteFriend(userId, userName, userEmoji) {
            favFriendsRef.child(userId).set({
                name: userName,
                emoji: userEmoji,
                addedTime: Date.now()
            }).then(() => {
                alert(`${userName} को पसंदीदा में जोड़ा गया!`);
                loadFavoriteFriends(); // सूची को रीफ़्रेश करें
            }).catch(error => {
                console.error("पसंदीदा दोस्त जोड़ने में त्रुटि: ", error);
                alert(`त्रुटि: ${userName} को पसंदीदा में नहीं जोड़ा जा सका।`);
            });
        }

        // ऐप शेयर करने का लॉजिक
        shareAppBtn.addEventListener('click', () => {
            const shareableLink = window.location.href;

            if (navigator.share) {
                navigator.share({
                    title: 'चैट ऐप',
                    text: `मेरे साथ इस चैट ऐप पर जुड़ें! ${shareableLink}`,
                    url: shareableLink
                }).then(() => console.log('Successfully shared'))
                  .catch((error) => console.error('Error sharing:', error));
            } else {
                // अगर शेयर API उपलब्ध नहीं है
                navigator.clipboard.writeText(`मेरे साथ इस चैट ऐप पर जुड़ें! ${shareableLink}`)
                    .then(() => {
                        alert('ऐप का लिंक क्लिपबोर्ड पर कॉपी हो गया है!');
                    })
                    .catch((err) => {
                        console.error('Failed to copy link: ', err);
                        alert('क्लिपबोर्ड पर कॉपी करने में असमर्थ। कृपया मैन्युअल रूप से लिंक कॉपी करें: ' + shareableLink);
                    });
            }
        });

        // मैसेज भेजने का फ़ंक्शन
        function sendMessage(messageText, messageType = 'text', recipientId = null, recipientName = null, recipientEmoji = null) {
            const messageData = {
                name: myName,
                emoji: myEmoji,
                text: messageText,
                time: Date.now(),
                userId: myId,
                type: messageType // 'text', 'dm', 'image', 'audio' etc.
            };

            if (messageType === 'dm') {
                messageData.recipientId = recipientId;
                messageData.recipientName = recipientName;
                messageData.recipientEmoji = recipientEmoji;

                // डायरेक्ट मैसेज को दोनों तरफ से सहेजें
                const senderRef = directMessagesRef.child(myId).child(recipientId);
                const receiverRef = directMessagesRef.child(recipientId).child(myId);

                senderRef.push(messageData);
                receiverRef.push(messageData);
            } else {
                // सामान्य चैट संदेश
                messagesRef.push(messageData);
            }
            msgInput.value = ''; // इनपुट बॉक्स खाली करें
        }

        // सेंड बटन पर क्लिक करने पर
        sendBtn.addEventListener('click', () => {
            const text = msgInput.value.trim();
            if (text !== "") {
                if (currentChatTarget) { // अगर डायरेक्ट मैसेजिंग में हैं
                    sendMessage(text, 'dm', currentChatTarget.id, currentChatTarget.name, currentChatTarget.emoji);
                } else { // अगर सामान्य चैट में हैं
                    sendMessage(text, 'text');
                }
            }
        });

        // Enter दबाने पर मैसेज भेजें
        msgInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendBtn.click(); // सेंड बटन पर क्लिक का अनुकरण करें
            }
        });

        // डायरेक्ट मैसेज चैट शुरू करने का फ़ंक्शन
        function startDirectMessage(userId, userName, userEmoji) {
            currentChatTarget = { id: userId, name: userName, emoji: userEmoji };
            chatHeader.innerHTML = `<button class="back-to-general-btn" id="backToGeneralBtn">⬅️ सामान्य चैट</button>💬 डायरेक्ट मैसेज (${userName})`; // हेडर अपडेट करें
            messagesContainer.innerHTML = ''; // पिछले संदेशों को साफ़ करें

            // यदि कोई पुराना DM लिसनर है तो उसे हटा दें
            if (dmMessagesListener) {
                directMessagesRef.child(myId).child(currentChatTarget.id).off('child_added', dmMessagesListener);
            }
            // यदि सामान्य संदेश लिसनर चल रहा है तो उसे हटा दें
            if (generalMessagesListener) {
                messagesRef.off('child_added', generalMessagesListener);
                generalMessagesListener = null; // Null सेट करें
            }

            // नए डायरेक्ट मैसेज के लिए लिसनर सेट करें
            dmMessagesListener = directMessagesRef.child(myId).child(userId).orderByChild('time').on('child_added', handleMessage);

            // backToGeneralBtn को फिर से सेट करें
            document.getElementById('backToGeneralBtn').onclick = backToGeneralChat;

            messagesContainer.scrollTop = messagesContainer.scrollHeight; // नीचे स्क्रॉल करें
            favFriendsModal.style.display = 'none'; // पसंदीदा दोस्तों का मोडल बंद करें
        }

        // सामान्य चैट पर वापस जाने का फ़ंक्शन
        function backToGeneralChat() {
            currentChatTarget = null;
            chatHeader.innerHTML = `💬 सामान्य चैट`; // हेडर को सामान्य चैट पर रीसेट करें
            messagesContainer.innerHTML = ''; // वर्तमान संदेशों को साफ़ करें

            // यदि कोई पुराना DM लिसनर है तो उसे हटा दें
            if (dmMessagesListener) {
                directMessagesRef.child(myId).child(userId).off('child_added', dmMessagesListener); // userId का स्कोप यहाँ समस्या कर सकता है, सुनिश्चित करें
                dmMessagesListener = null; // Null सेट करें
            }

            // सामान्य चैट संदेशों के लिए लिसनर को फिर से अटैच करें
            loadGeneralMessages();
        }

        // किसी भी प्रकार के संदेश (सामान्य या DM) को संभालने का फ़ंक्शन
        function handleMessage(snap) {
            const msg = snap.val();
            const msgEl = document.createElement('div');

            // संदेश भेजने वाला कौन है यह जांचें
            const isMe = msg.userId === myId;
            msgEl.className = `message ${isMe ? 'sent' : 'received'}`;

            // DM संदेश के लिए प्राप्तकर्ता का नाम दिखाएं, अगर यह मेरा संदेश नहीं है
            const authorDisplay = !isMe ?
                `<div class="msg-author">
                    <span class="msg-author-emoji">${msg.emoji || '👤'}</span>
                    ${msg.name}
                </div>` : '';

            msgEl.innerHTML = `
                ${authorDisplay}
                <div class="msg-text">${msg.text}</div>
                <div class="msg-time">${formatTime(msg.time)}</div>
            `;

            messagesContainer.appendChild(msgEl);
            messagesContainer.scrollTop = messagesContainer.scrollHeight; // हमेशा नीचे स्क्रॉल करें
        }

        // सामान्य चैट संदेशों को लोड करना और सुनना
        function loadGeneralMessages() {
            // सुनिश्चित करें कि पहले से कोई सामान्य लिसनर न चल रहा हो
            if (generalMessagesListener) {
                messagesRef.off('child_added', generalMessagesListener);
            }
            // 30 नवीनतम सामान्य संदेशों को लोड करें और नए संदेशों के लिए लिसनर जोड़ें
            generalMessagesListener = messagesRef.orderByChild('time').limitToLast(30).on('child_added', handleMessage);
        }

        // समय को फॉर्मेट करने का फ़ंक्शन
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('hi-IN', { hour: '2-digit', minute: '2-digit' });
        }

        // ऑनलाइन उपयोगकर्ताओं को सुनने के लिए लिसनर
        usersRef.on('child_added', (snap) => {
            const user = snap.val();
            const userId = snap.key;

            if (userId === myId) return; // खुद को सूची में न दिखाएं

            // अगर उपयोगकर्ता पहले से मौजूद नहीं है
            if (!userElements[userId]) {
                const userEl = document.createElement('div');
                userEl.className = 'user-item';
                userEl.innerHTML = `
                    <div class="user-avatar">${user.emoji || '👤'}</div>
                    <div class="user-details">
                        <div class="user-name">${user.name}</div>
                        <div class="user-status">ऑनलाइन</div>
                    </div>
                    <div class="online-dot"></div>
                `;

                usersList.appendChild(userEl);
                userElements[userId] = userEl; // DOM तत्व को स्टोर करें
                onlineUsers++;
                userCount.textContent = onlineUsers; // काउंटर अपडेट करें

                // उपयोगकर्ता आइटम पर क्लिक करने पर DM शुरू करें या पसंदीदा बनाएं
                userEl.onclick = () => {
                    // पसंदीदा बनाने का विकल्प या डायरेक्ट मैसेज का विकल्प
                    if (confirm(`क्या आप ${user.name} के साथ डायरेक्ट मैसेज शुरू करना चाहते हैं?`)) {
                        startDirectMessage(userId, user.name, user.emoji);
                    } else if (confirm(`क्या आप ${user.name} को पसंदीदा दोस्त बनाना चाहते हैं?`)) {
                        addFavoriteFriend(userId, user.name, user.emoji);
                    }
                };
            }
        });

        // जब किसी ऑनलाइन उपयोगकर्ता की जानकारी बदलती है
        usersRef.on('child_changed', (snap) => {
            const user = snap.val();
            const userId = snap.key;

            if (userElements[userId]) {
                // उपयोगकर्ता तत्व को अपडेट करें
                userElements[userId].innerHTML = `
                    <div class="user-avatar">${user.emoji || '👤'}</div>
                    <div class="user-details">
                        <div class="user-name">${user.name}</div>
                        <div class="user-status">ऑनलाइन</div>
                    </div>
                    <div class="online-dot"></div>
                `;
                // अगर यह पसंदीदा दोस्त सूची में भी है, तो उसे भी अपडेट करें
                if (favFriendElements[userId]) {
                    favFriendElements[userId].querySelector('.user-avatar').textContent = user.emoji || '👤';
                    favFriendElements[userId].querySelector('.user-name').textContent = user.name;
                }
            }
        });

        // जब कोई उपयोगकर्ता ऑफ़लाइन होता है
        usersRef.on('child_removed', (snap) => {
            const userId = snap.key;
            if (userElements[userId]) {
                userElements[userId].remove(); // DOM से हटाएं
                delete userElements[userId]; // स्टोर से हटाएं
                onlineUsers--;
                userCount.textContent = onlineUsers; // काउंटर अपडेट करें
            }
        });

        // अटैचमेंट बटन क्लिक हैंडलर
        attachmentBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // क्लिक को फैलने से रोकें
            attachmentMenu.classList.toggle('show'); // मेनू को टॉगल करें
        });

        // अटैचमेंट मेनू के विकल्पों के लिए हैंडलर
        document.getElementById('photoBtn').addEventListener('click', () => {
            alert('फोटो अपलोड फीचर अभी लागू नहीं किया गया है!');
            attachmentMenu.classList.remove('show');
        });
        document.getElementById('audioBtn').addEventListener('click', () => {
            alert('आवाज रिकॉर्डिंग फीचर अभी लागू नहीं किया गया है!');
            attachmentMenu.classList.remove('show');
        });
        document.getElementById('fileBtn').addEventListener('click', () => {
            alert('फाइल अटैचमेंट फीचर अभी लागू नहीं किया गया है!');
            attachmentMenu.classList.remove('show');
        });
        document.getElementById('videoCallBtn').addEventListener('click', () => {
            alert('वीडियो कॉल फीचर अभी लागू नहीं किया गया है!');
            attachmentMenu.classList.remove('show');
        });

        // इनपुट पर फोकस करें जब पेज लोड होता है
        msgInput.focus();

        // सामान्य चैट लोड करें जब पेज लोड होता है
        loadGeneralMessages();
    </script>
</body>
</html>